# yaml-language-server: $schema=https://raw.githubusercontent.com/not-first/glance-schema/master/schema.json#/properties/pages
- name: Staging
  columns:
    - size: full
      widgets:
        # Authentik Applications - Custom API widget
        - type: custom-api
          title: Authentik Applications
          url: https://authentik.${ROOT_DOMAIN}/api/v3/core/applications/
          cache: 1h
          headers:
            Authorization: Bearer ${AUTHENTIK_API_TOKEN}
            Accept: application/json
          template: |
            <style>
              .app-group { margin-bottom: 20px; }
              .app-group-title { font-weight: bold; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid var(--color-separator); }
              .app-list { display: flex; flex-wrap: wrap; gap: 10px; }
              .app-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 12px;
                background: rgba(0,0,0,0.05);
                border-radius: 6px;
                text-decoration: none;
                color: var(--color-primary);
                transition: all 0.2s ease;
              }
              .app-item:hover {
                background: rgba(0,0,0,0.1);
                transform: translateY(-2px);
              }
              .app-icon {
                width: 24px;
                height: 24px;
                object-fit: contain;
              }
              .app-name { font-size: 0.95rem; }
            </style>

            {{ $appsByGroup := dict }}
            {{ range .JSON.Array "results" }}
              {{ $group := .String "group" }}
              {{ if not (index $appsByGroup $group) }}
                {{ $_ := set $appsByGroup $group (slice) }}
              {{ end }}
              {{ $apps := index $appsByGroup $group }}
              {{ $_ := set $appsByGroup $group (append $apps .) }}
            {{ end }}

            {{ range $group, $apps := $appsByGroup }}
              <div class="app-group">
                <div class="app-group-title">{{ $group }}</div>
                <div class="app-list">
                  {{ range $apps }}
                    {{ $url := .String "meta_launch_url" }}
                    {{ if $url }}
                      <a href="{{ $url }}" target="_blank" class="app-item" title="{{ .String "meta_description" }}">
                        {{ if .String "meta_icon" }}
                          <img src="{{ .String "meta_icon" }}" alt="{{ .String "name" }}" class="app-icon">
                        {{ end }}
                        <span class="app-name">{{ .String "name" }}</span>
                      </a>
                    {{ end }}
                  {{ end }}
                </div>
              </div>
            {{ end }}

    - size: small
      widgets:
        # Proxmox VE Stats
        - type: custom-api
          title: Proxmox Stats
          url: https://${proxmox_endpoint}/api2/json/nodes
          cache: 5m
          allow-insecure: true
          headers:
            Authorization: PVEAPIToken=${proxmox_credential}
          template: |
            <style>
              .stat-item { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--color-separator); }
              .stat-label { font-weight: 500; }
              .stat-value { color: var(--color-primary); }
            </style>
            {{ range .JSON.Array "data" }}
              <div class="stat-item">
                <span class="stat-label">{{ .String "node" }}</span>
                <span class="stat-value">{{ if .Bool "status" | eq "online" }}üü¢{{ else }}üî¥{{ end }} {{ .String "status" }}</span>
              </div>
            {{ end }}

        # Gatus Monitor
        - type: custom-api
          title: Service Status
          url: https://gatus.${ROOT_DOMAIN}/api/v1/statuses
          cache: 2m
          template: |
            <style>
              .status-item { display: flex; justify-content: space-between; margin-bottom: 5px; padding: 5px 0; }
              .status-up { color: var(--color-positive); }
              .status-down { color: var(--color-negative); }
            </style>
            {{ range .JSON.Array "results" }}
              <div class="status-item">
                <span>{{ .String "name" }}</span>
                <span class="{{ if .Bool "up" }}status-up{{ else }}status-down{{ end }}">
                  {{ if .Bool "up" }}‚úì Up{{ else }}‚úó Down{{ end }}
                </span>
              </div>
            {{ end }}

        # GitHub Notifications (Official Glance Widget)
        - type: custom-api
          title: GitHub Notifications
          url: https://api.github.com/notifications?all=true&per_page=20
          cache: 30m
          headers:
            Authorization: Bearer ${github_token}
            Accept: application/vnd.github+json
          template: |
            <ul class="list list-gap-14 collapsible-container" data-collapse-after="6">
            {{ range .JSON.Array "" }}
              {{ $url := concat (.String "repository.html_url") "/actions" }}
              {{ if ne (.String "subject.url") "" }}
                {{
                  $notification := newRequest (.String "subject.url")
                    | withHeader "Authorization" "Bearer ${github_token}"
                    | getResponse
                }}
                {{ if eq $notification.Response.StatusCode 200 }}
                  {{ $url = $notification.JSON.String "html_url" }}
                {{ else }}
                  {{ $url = (.String "subject.url") | replaceMatches "repos\\/" "" | replaceMatches "api\\." "" | replaceAll "pulls" "pull" }}
                {{ end }}
              {{ end }}
              <li>
                <a href="{{ $url }}" class="size-title-dynamic {{ if .Bool "unread" }}color-primary-if-not-visited{{ else }}negative-color{{ end }}" target="_blank" rel="noreferrer">{{ .String "subject.title" }}</a>
                <ul class="list-horizontal-text flex-nowrap">
                  <li class="min-width-0" {{ .String "updated_at" | parseTime "rfc3339" | toRelativeTime }}></li>
                  <li class="min-width-0"><a target="_blank" href="{{ $url }}">{{ .String "repository.full_name" }}</a></li>
                </ul>
              </li>
            {{ end }}
            </ul>

    - size: small
      widgets:
        # glance-k8s Nodes (equestria)
        - type: extension
          url: http://glance-k8s.observability.svc.cluster.local:8080/extension/nodes
          allow-potentially-dangerous-html: true
          cache: 30s
          title: Equestria Nodes

        # glance-k8s Apps (equestria)
        - type: extension
          url: http://glance-k8s.observability.svc.cluster.local:8080/extension/apps
          allow-potentially-dangerous-html: true
          cache: 1m
          title: Equestria Apps
          parameters:
            show-if: glance.hide != "true"

        # glance-k8s Apps (stargate) - via Tailscale cross-cluster access
        - type: extension
          url: https://glance-k8s.sgc.internal/extension/apps
          allow-potentially-dangerous-html: true
          cache: 1m
          title: Stargate Apps
          parameters:
            show-if: glance.hide != "true"
          allow-insecure: true

        # glance-k8s Nodes (stargate) - via Tailscale cross-cluster access
        - type: extension
          url: https://glance-k8s.sgc.internal/extension/nodes
          allow-potentially-dangerous-html: true
          cache: 30s
          title: Stargate Nodes
          parameters:
            show-if: glance.hide != "true"
          allow-insecure: true

    - size: small
      widgets:
        # Epic Games Free Games
        - type: custom-api
          title: Epic Games Free
          cache: 1h
          url: https://store-site-backend-static.ak.epicgames.com/freeGamesPromotions?locale=en&country=US&allowCountries=US
          template: |
            <div>
              {{ if eq .Response.StatusCode 200 }}
                <div class="horizontal-cards-2">
                  {{ range .JSON.Array "data.Catalog.searchStore.elements" }}
                    {{ $price := .String "price.totalPrice.discountPrice" }}
                    {{ $hasPromo := gt (len (.Array "promotions.promotionalOffers")) 0 }}
                    {{ if and $hasPromo (eq $price "0") }}
                      {{ $gamePage := .String "productSlug" }}
                      {{ if gt (len (.Array "offerMappings")) 0 }}
                        {{ $gamePage = .String "offerMappings.0.pageSlug" }}
                      {{ end }}
                      <a href="https://store.epicgames.com/en-US/p/{{ $gamePage }}" target="_blank" class="card">
                        {{ $title := .String "title" }}
                        {{ range .Array "keyImages" }}
                          {{ if eq (.String "type") "OfferImageWide" }}
                            <img src="{{ .String "url" }}" alt="{{ $title }}" style="width: 100%; max-width: 300px; height: 150px; object-fit: cover; border-radius: var(--border-radius);">
                          {{ end }}
                        {{ end }}
                        <div class="card-content">
                          <span class="size-base color-primary">{{ $title }}</span><br>
                          <span class="size-h5 color-subdue">
                            {{ if $hasPromo }}
                              {{ $promotions := .Array "promotions.promotionalOffers" }}
                              {{ if gt (len $promotions) 0 }}
                                {{ $firstPromo := index $promotions 0 }}
                                {{ $offers := $firstPromo.Array "promotionalOffers" }}
                                {{ if gt (len $offers) 0 }}
                                  {{ $firstOffer := index $offers 0 }}
                                  Free until {{ slice ($firstOffer.String "endDate") 0 10 }}
                                {{ else }}
                                  Free this week!
                                {{ end }}
                              {{ else }}
                                Free this week!
                              {{ end }}
                            {{ end }}
                          </span>
                        </div>
                      </a>
                    {{ end }}
                  {{ end }}
                </div>
              {{ else }}
                <p class="color-negative">Error fetching Epic Games data.</p>
              {{ end }}
            </div>

        # NHL Scores (Official Glance Widget)
        - type: custom-api
          title: NHL Today
          cache: 5s
          url: https://api-web.nhle.com/v1/score/now
          template: |
            {{ $myTeam := "ALL" }}
            {{ $games := .JSON.Array "games" }}
            {{ define "gameItem" }}
              {{ $toolTipEnabled := true }}
              {{ $awayTeamColor := "" }}
              {{ $homeTeamColor := "" }}
              {{ $situationDescriptionHome := "" }}
              {{ $situationDescriptionAway := "" }}
              {{ $situationStrength := "" }}
              {{ $homeTeam := .String "homeTeam.abbrev" }}
              {{ $awayTeam := .String "awayTeam.abbrev" }}
              {{ $homeTeamScores := "" }}
              {{ $awayTeamScores := "" }}
              {{ range $index, $desc := .Array "goals" }}
                {{ $teamAbbrev := .String "teamAbbrev" }}
                {{ $playerName := .String "name.default" }}
                {{ $timeScored := .String "timeInPeriod" }}
                {{ $periodScored := .Int "period" }}
                {{ if eq $awayTeam $teamAbbrev }}
                  {{ $awayTeamScores = (printf "%s %s %s(%d)" $awayTeamScores $playerName $timeScored $periodScored) }}
                {{ else if eq $homeTeam $teamAbbrev }}
                  {{ $homeTeamScores = (printf "%s %s %s(%d)" $homeTeamScores $playerName $timeScored $periodScored) }}
                {{ end }}
              {{ end }}
              {{ $gameState := .String "gameState" }}
              {{ $currentLabel := "" }}
              {{ if or (eq $gameState "OFF") (eq $gameState "FINAL") }}
                {{ $lastPeriodType := .String "gameOutcome.lastPeriodType" }}
                {{ $currentLabel = "Final" }}
                {{ if or (eq $lastPeriodType "OT") (eq $lastPeriodType "SO") }}
                  {{ $currentLabel = (printf "%s %s" $currentLabel $lastPeriodType) }}
                {{ end }}
              {{ end }}
              {{ if or (eq $gameState "FUT") (eq $gameState "PRE") }}
                {{ $gameTime := (.String "startTimeUTC" | parseTime "rfc3339").In now.Location }}
                {{ $currentLabel = (printf "%02d:%02d" $gameTime.Hour $gameTime.Minute) }}
              {{ end }}
              {{ if or (eq $gameState "LIVE") (eq $gameState "CRIT") }}
                {{ $period := .Int "period" }}
                {{ $timeRemaining := .String "clock.timeRemaining" }}
                {{ $intermission := .Int "clock.inIntermission" }}
                {{ $periodType := .String "periodDescriptor.periodType" }}
                {{ if eq $period 1 }}
                  {{ $addonValue := "st" }}
                  {{ if eq $intermission 1 }}
                    {{ $addonValue = printf "%s Int" $addonValue }}
                  {{ end }}
                  {{ $currentLabel = (printf "%s%s %s" $period $addonValue $timeRemaining) }}
                {{ else if eq $period 2 }}
                  {{ $addonValue := "nd" }}
                  {{ if eq $intermission 1 }}
                    {{ $addonValue = printf "%s Int" $addonValue }}
                  {{ end }}
                  {{ $currentLabel = (printf "%s%s %s" $period $addonValue $timeRemaining) }}
                {{ else if eq $period 3 }}
                  {{ $addonValue := "rd" }}
                  {{ if eq $intermission 1 }}
                    {{ $addonValue = printf "%s Int" $addonValue }}
                  {{ end }}
                  {{ $currentLabel = (printf "%s%s %s" $period $addonValue $timeRemaining) }}
                {{ else }}
                  {{ $currentLabel = $periodType }}
                  {{ if not (eq $periodType "SO") }}
                    {{ $currentLabel = (printf "%s %s" $periodType $timeRemaining) }}
                  {{ end }}
                {{ end }}
              {{ end }}
              {{ if .Exists "situation" }}
                {{ if .Exists "situation.awayTeam.situationDescriptions" }}
                  {{ $awayTeamColor = "color-negative" }}
                  {{ range $index, $desc := .Array "situation.awayTeam.situationDescriptions" }}
                    {{ $situationDescriptionAway = (printf "%s %s" $situationDescriptionAway $desc.Value) }}
                  {{ end }}
                {{ end }}
                {{ if .Exists "situation.homeTeam.situationDescriptions" }}
                  {{ $homeTeamColor = "color-positive" }}
                  {{ range $index, $desc := .Array "situation.homeTeam.situationDescriptions" }}
                    {{ $situationDescriptionHome = (printf "%s %s" $situationDescriptionHome $desc.Value) }}
                  {{ end }}
                {{ end }}
                {{ $situationStrength = concat "(" (.String "situation.awayTeam.strength") "v" (.String "situation.homeTeam.strength") ")" }}
              {{ end }}
              <table>
                <tr>
                  <td>
                    <a target="_blank" class="size-h3 color-highlight block text-truncate" href="https://www.nhl.com{{ .String "gameCenterLink" }}/">
                      <span class="{{ $awayTeamColor }}">{{ .String "awayTeam.name.default" }}</span> vs <span class="{{ $homeTeamColor }}">{{ .String "homeTeam.name.default" }}</span>
                    </a>
                  </td>
                </tr>
                <tr>
                  <td>
                    <span class="{{ $awayTeamColor }}">{{ $situationDescriptionAway }}</span> <span class="{{ $homeTeamColor }}">{{ $situationDescriptionHome }}</span> <span>{{ .String "situation.timeRemaining" }} {{ $situationStrength }}</span>
                  </td>
                </tr>
              </table>
              <table>
                <tr>
                  <td data-popover-type="html">
                    {{ if and (not (eq $awayTeamScores "")) (eq $toolTipEnabled true) }}
                      <div data-popover-html>{{ $awayTeamScores }}</div>
                    {{ end }}
                    <img style="float: left" width="50" height="auto" src="{{ .String "awayTeam.logo" }}">
                  </td>
                  <td data-popover-type="html">
                    {{ if and (not (eq $awayTeamScores "")) (eq $toolTipEnabled true) }}
                      <div data-popover-html>{{ $awayTeamScores }}</div>
                    {{ end }}
                    <p style="font-size:25px">{{ .String "awayTeam.score" }}</p>
                  </td>
                  <td>
                    <p style="font-size:25px">-</p>
                  </td>
                  <td data-popover-type="html">
                    {{ if and (not (eq $homeTeamScores "")) (eq $toolTipEnabled true) }}
                      <div data-popover-html>{{ $homeTeamScores }}</div>
                    {{ end }}
                    <p style="font-size:25px">{{ .String "homeTeam.score" }}</p>
                  </td>
                  <td data-popover-type="html">
                    {{ if and (not (eq $homeTeamScores "")) (eq $toolTipEnabled true) }}
                      <div data-popover-html>{{ $homeTeamScores }}</div>
                    {{ end }}
                    <img style="float: left" width="50" height="auto" src="{{ .String "homeTeam.logo" }}">
                  </td>
                  <td>{{ $currentLabel }}</td>
                </tr>
              </table>
            {{ end }}
            <ul class="list list-gap-10 collapsible-container" data-collapse-after="10">
            {{ range $game := $games }}
              {{ if and (or (eq ($game.String "homeTeam.abbrev") $myTeam) (eq ($game.String "awayTeam.abbrev") $myTeam) (eq "ALL" $myTeam)) }}
                {{ $state := $game.String "gameState" }}
                {{ if not (or (eq $state "FINAL") (eq $state "OFF")) }}
                  {{ template "gameItem" $game }}
                {{ end }}
              {{ end }}
            {{ end }}
            {{ range $game := $games }}
              {{ if and (or (eq ($game.String "homeTeam.abbrev") $myTeam) (eq ($game.String "awayTeam.abbrev") $myTeam) (eq "ALL" $myTeam)) }}
                {{ $state := $game.String "gameState" }}
                {{ if or (eq $state "FINAL") (eq $state "OFF") }}
                  {{ template "gameItem" $game }}
                {{ end }}
              {{ end }}
            {{ end }}
            </ul>

        # XKCD
        - type: custom-api
          title: XKCD
          cache: 2m
          url: https://xkcd.com/info.0.json
          template: |
            <div style="text-align: center;">
              <h4 style="margin: 0 0 10px 0;">{{ .JSON.String "title" }}</h4>
              <img src="{{ .JSON.String "img" }}" style="max-width: 100%; height: auto; border-radius: var(--border-radius);">
              <p style="margin: 8px 0 0 0; font-size: 0.85rem; color: var(--color-subdue);">{{ .JSON.String "alt" }}</p>
            </div>

    - size: small
      widgets:
        # Proxmox Backup Server Stats
        - type: custom-api
          title: PBS Stats
          cache: 5m
          allow-insecure: true
          url: https://${pbs_host}/api2/json/nodes/localhost/status
          headers:
            Authorization: ${pbs_token}
          template: |
            <style>
              .pbs-stat { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-separator); }
              .pbs-stat-label { font-weight: 500; }
              .pbs-stat-value { color: var(--color-highlight); }
            </style>
            {{ if eq .Response.StatusCode 200 }}
              {{ $data := .JSON.Get "data" }}
              {{ $cpuUsage := mul ($data.Float "cpu") 100.0 }}
              {{ $memPercent := mul (div ($data.Float "memory.used") ($data.Float "memory.total")) 100.0 }}
              {{ $diskPercent := mul (div ($data.Float "root.used") ($data.Float "root.total")) 100.0 }}
              <div class="pbs-stat">
                <span class="pbs-stat-label">CPU</span>
                <span class="pbs-stat-value">{{ printf "%.0f" $cpuUsage }}%</span>
              </div>
              <div class="pbs-stat">
                <span class="pbs-stat-label">RAM</span>
                <span class="pbs-stat-value">{{ printf "%.0f" $memPercent }}%</span>
              </div>
              <div class="pbs-stat">
                <span class="pbs-stat-label">Disk</span>
                <span class="pbs-stat-value">{{ printf "%.0f" $diskPercent }}%</span>
              </div>
            {{ else }}
              <p class="color-negative">Failed to connect to PBS</p>
            {{ end }}

        # Cloudflare Tunnels
        - type: custom-api
          title: Cloudflare Tunnels
          cache: 4h
          url: https://api.cloudflare.com/client/v4/accounts/${cf_accountId}/cfd_tunnel/${cf_username}/configurations
          headers:
            Authorization: Bearer ${cf_credential}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-10">
              {{ range .JSON.Array "result.config.ingress" }}
                {{ if (.String "hostname") }}
                  <li style="padding: 6px 0;">
                    <a href="https://{{ .String "hostname" }}" class="color-highlight" target="_blank" style="text-decoration: none;">
                      {{ .String "hostname" | trimSuffix ".${ROOT_DOMAIN}" }}
                    </a>
                    {{ if (.String "service") }}
                      <div style="font-size: 0.85rem; color: var(--color-subdue); margin-top: 2px;">
                        ‚Üí {{ .String "service" }}
                      </div>
                    {{ end }}
                  </li>
                {{ end }}
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load tunnels (Status: {{ .Response.StatusCode }})</p>
            {{ end }}

        # Prowlarr Indexers
        - type: custom-api
          title: Prowlarr Indexers
          cache: 1m
          url: http://prowlarr.equestria.svc.cluster.local:9696/api/v1/indexer
          headers:
            Accept: application/json
            X-Api-Key: ${prowlarr_apikey}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range .JSON.Array "" }}
                <li style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <a href="http://prowlarr.equestria.svc.cluster.local:9696" target="_blank" class="color-highlight" style="text-decoration: none; flex: 1;">{{ .String "name" }}</a>
                  {{ if eq (.String "enable") "true" }}
                    <span style="color: var(--color-positive); font-weight: bold;">‚úì</span>
                  {{ else }}
                    <span style="color: var(--color-negative); font-weight: bold;">‚úó</span>
                  {{ end }}
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load indexers</p>
            {{ end }}

    # Media Servers
    - size: small
      widgets:
        # Tautulli Stats
        - type: custom-api
          title: Tautulli Stats
          url: http://tautulli.equestria.svc.cluster.local:8181/api/v2?apikey=${tautulli_api_key}&cmd=get_activity
          cache: 5m
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 5 (.JSON.Array "response.data.sessions") }}
                <li style="padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <strong>{{ .String "full_title" }}</strong><br>
                  <span style="font-size: 0.85rem; color: var(--color-subdue);">{{ .String "user" }} ‚Ä¢ {{ .String "quality_profile" }}</span>
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load Tautulli data</p>
            {{ end }}

        # Media Server History (Plex)
        - type: custom-api
          title: Recently Played
          url: http://tautulli.equestria.svc.cluster.local:8181/api/v2?apikey=${tautulli_api_key}&cmd=get_history&length=10
          cache: 5m
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 8 (.JSON.Array "response.data.data") }}
                <li style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <span>{{ .String "full_title" }}</span>
                  <span style="color: var(--color-subdue); font-size: 0.85rem;">{{ .String "user" }}</span>
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load history</p>
            {{ end }}

        # Media Server Playing (Active Sessions)
        - type: custom-api
          title: Now Playing
          url: http://tautulli.equestria.svc.cluster.local:8181/api/v2?apikey=${tautulli_api_key}&cmd=get_activity
          cache: 30s
          template: |
            {{ if eq .Response.StatusCode 200 }}
              {{ if eq (len (.JSON.Array "response.data.sessions")) 0 }}
                <p class="color-subdue">No active sessions</p>
              {{ else }}
                <ul class="list list-gap-8">
                {{ range .JSON.Array "response.data.sessions" }}
                  <li style="padding: 8px 0; border-bottom: 1px solid var(--color-separator);">
                    <strong>{{ .String "full_title" }}</strong><br>
                    <span style="font-size: 0.85rem; color: var(--color-subdue);">{{ .String "user" }} ‚Ä¢ {{ .String "state" }}</span>
                  </li>
                {{ end }}
                </ul>
              {{ end }}
            {{ else }}
              <p class="color-negative">Failed to load playback data</p>
            {{ end }}

        # Jellyfin Latest
        - type: custom-api
          title: Jellyfin Latest
          url: http://jellyfin.equestria.svc.cluster.local:8096/api/Users/${jellyfin_user_id}/Items/Latest?api_key=${jellyfin_api_key}&limit=10
          cache: 1h
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 6 (.JSON.Array "") }}
                <li style="padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <span>{{ .String "Name" }}</span><br>
                  <span style="font-size: 0.85rem; color: var(--color-subdue);">{{ .String "Type" }}</span>
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load Jellyfin content</p>
            {{ end }}

    # Infrastructure & Detailed Resources
    - size: small
      widgets:
        # Proxmox Detailed Resources
        - type: custom-api
          title: Proxmox Resources
          url: https://${proxmox_endpoint}/api2/json/nodes
          cache: 2m
          allow-insecure: true
          headers:
            Authorization: PVEAPIToken=${proxmox_credential}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range .JSON.Array "data" }}
                {{ if eq (.String "type") "qemu" }}
                  <li style="padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                    <strong>{{ .String "name" }}</strong><br>
                    <span style="font-size: 0.85rem; color: var(--color-subdue);">{{ .String "status" }} ‚Ä¢ CPU: {{ .String "cpu" }}% ‚Ä¢ RAM: {{ .String "memory" }}%</span>
                  </li>
                {{ end }}
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load Proxmox resources</p>
            {{ end }}

        # Grafana Metrics
        - type: custom-api
          title: Grafana
          url: http://grafana.observability.svc.cluster.local/api/health
          cache: 5m
          headers:
            Authorization: Bearer ${grafana_token}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <div style="padding: 10px; background: rgba(0,0,0,0.05); border-radius: 6px;">
                <p style="margin: 0; color: var(--color-highlight);">Grafana Connected</p>
                <a href="http://grafana.observability.svc.cluster.local/d/" target="_blank" class="color-primary" style="text-decoration: none; font-size: 0.85rem;">‚Üí View Dashboards</a>
              </div>
            {{ else }}
              <p class="color-negative">Failed to connect to Grafana</p>
            {{ end }}

    # Media & Arr Stack
    - size: small
      widgets:
        # Arr Releases (Sonarr)
        - type: custom-api
          title: Sonarr Upcoming
          url: http://sonarr.equestria.svc.cluster.local:8989/api/v3/calendar?includeUnmonitored=false
          cache: 30m
          headers:
            X-Api-Key: ${sonarr_api_key}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 8 (.JSON.Array "") }}
                <li style="padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <strong>{{ .String "series.title" }}</strong><br>
                  <span style="font-size: 0.85rem; color: var(--color-subdue);">S{{ printf "%02d" (.Int "seasonNumber") }}E{{ printf "%02d" (.Int "episodeNumber") }} ‚Ä¢ {{ .String "airDateUtc" | slice 0 10 }}</span>
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load Sonarr data</p>
            {{ end }}

        # Unifi Network Widget
        - type: custom-api
          title: UniFi Network
          url: https://discord.${ROOT_DOMAIN}/api/s/default/stat/uptime
          cache: 1m
          allow-insecure: true
          headers:
            Authorization: Bearer ${unifi_api_key}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <style>
                .unifi-stat { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-separator); }
                .unifi-label { font-weight: 500; }
                .unifi-value { color: var(--color-highlight); }
              </style>
              {{ range first 1 (.JSON.Array "data") }}
                <div class="unifi-stat">
                  <span class="unifi-label">Gateway</span>
                  <span class="unifi-value">{{ .String "status" }}</span>
                </div>
                <div class="unifi-stat">
                  <span class="unifi-label">Uptime</span>
                  <span class="unifi-value">{{ div (.Int "uptime") 86400 }}d</span>
                </div>
              {{ end }}
            {{ else }}
              <p class="color-negative">Failed to connect to UniFi</p>
            {{ end }}

    # Backup & Media Libraries
    - size: small
      widgets:
        # Backrest Backup Status
        - type: custom-api
          title: Backrest Backups
          method: POST
          url: https://backrest.luna.${ROOT_DOMAIN}/api/stats
          cache: 5m
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 5 (.JSON.Array "snapshots") }}
                <li style="padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <strong>{{ .String "id" | slice 0 8 }}</strong><br>
                  <span style="font-size: 0.85rem; color: var(--color-subdue);">{{ .String "time" | slice 0 10 }} ‚Ä¢ {{ .String "size.GB" }}GB</span>
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load backups</p>
            {{ end }}

        # Backrest Backup Status (Celestia)
        - type: custom-api
          title: Backrest Backups (Celestia)
          method: POST
          url: https://backrest.celestia.${ROOT_DOMAIN}/api/stats
          cache: 5m
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 5 (.JSON.Array "snapshots") }}
                <li style="padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <strong>{{ .String "id" | slice 0 8 }}</strong><br>
                  <span style="font-size: 0.85rem; color: var(--color-subdue);">{{ .String "time" | slice 0 10 }} ‚Ä¢ {{ .String "size.GB" }}GB</span>
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load backups</p>
            {{ end }}

        # RomM Stats
        - type: custom-api
          title: RomM Library
          url: http://romm.equestria.svc.cluster.local/api/stats
          cache: 1d
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <style>
                .romm-stat { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--color-separator); }
                .romm-label { font-weight: 500; }
                .romm-value { color: var(--color-highlight); font-weight: bold; }
              </style>
              <div class="romm-stat">
                <span class="romm-label">Platforms</span>
                <span class="romm-value">{{ .Int "platforms" }}</span>
              </div>
              <div class="romm-stat">
                <span class="romm-label">Games</span>
                <span class="romm-value">{{ .Int "games" }}</span>
              </div>
              <div class="romm-stat">
                <span class="romm-label">Size</span>
                <span class="romm-value">{{ .String "total_size" }}</span>
              </div>
            {{ else }}
              <p class="color-negative">Failed to load RomM stats</p>
            {{ end }}

        # Immich Stats
        - type: custom-api
          title: Immich Photos
          url: http://immich.equestria.svc.cluster.local:2283/api/statistics
          cache: 1h
          headers:
            x-api-key: ${immich_api_key}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <style>
                .immich-stat { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--color-separator); }
                .immich-label { font-weight: 500; }
                .immich-value { color: var(--color-highlight); font-weight: bold; }
              </style>
              <div class="immich-stat">
                <span class="immich-label">Photos</span>
                <span class="immich-value">{{ .Int "photos" }}</span>
              </div>
              <div class="immich-stat">
                <span class="immich-label">Videos</span>
                <span class="immich-value">{{ .Int "videos" }}</span>
              </div>
              <div class="immich-stat">
                <span class="immich-label">Storage</span>
                <span class="immich-value">{{ div (.Int "usage") 1073741824 }}GB</span>
              </div>
            {{ else }}
              <p class="color-negative">Failed to load Immich stats</p>
            {{ end }}

    # Development & GitHub
    - size: small
      widgets:
        # GitHub Personal Repos
        - type: custom-api
          title: My Repos
          url: https://api.github.com/user/repos?sort=updated&per_page=15&affiliation=owner
          cache: 30m
          headers:
            Authorization: Bearer ${github_token}
            Accept: application/vnd.github+json
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <ul class="list list-gap-8">
              {{ range first 6 (.JSON.Array "") }}
                <li style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid var(--color-separator);">
                  <a href="{{ .String "html_url" }}" target="_blank" class="color-highlight" style="text-decoration: none; flex: 1;">{{ .String "name" }}</a>
                  {{ if gt (.Int "stargazers_count") 0 }}
                    <span style="font-size: 0.85rem; color: var(--color-subdue);">‚≠ê {{ .Int "stargazers_count" }}</span>
                  {{ end }}
                </li>
              {{ end }}
              </ul>
            {{ else }}
              <p class="color-negative">Failed to load repos</p>
            {{ end }}

        # SABnzbd Stats (Usenet Download Manager)
        - type: custom-api
          title: SABnzbd Status
          cache: 30s
          url: http://sabnzbd.equestria.svc.cluster.local:8080/api?output=json&apikey=${sabnzbd_api_key}&mode=queue
          headers:
            Accept: application/json
          template: |
            <div class="p-2">
              <div class="flex justify-between mb-2">
                <div class="flex-1">
                  <div class="size-h6">SPEED</div>
                  <div class="color-highlight size-h3">{{ if eq (.JSON.String "queue.status") "Downloading" }}{{ .JSON.String "queue.speed" }}B/s{{ else }}Paused{{ end }}</div>
                </div>
                <div class="flex-1">
                  <div class="size-h6">TIME LEFT</div>
                  <div class="color-highlight size-h3">{{ if eq (.JSON.String "queue.status") "Downloading" }}{{ .JSON.String "queue.timeleft" }}{{ else }}--:--:--{{ end }}</div>
                </div>
              </div>
              <div class="flex justify-between mb-2">
                <div class="flex-1">
                  <div class="size-h6">QUEUE</div>
                  <div class="color-highlight size-h3">{{ .JSON.Int "queue.noofslots" }} items</div>
                </div>
                <div class="flex-1">
                  <div class="size-h6">SIZE</div>
                  <div class="color-highlight size-h3">{{ .JSON.Float "queue.mb" | printf "%.1f" }}MB</div>
                </div>
              </div>
            </div>
